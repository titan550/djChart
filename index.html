<!DOCTYPE html>
<html>
    <head>
        <title>Chart using XML Data</title>
        <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="moment.min.js"></script>
        <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
        <script type="text/javascript">          
            
    window.onload = function() {
        var dataPoints = [];
        function getFilePath()
        {
        	var filePath = "https://cors.io/?http://www.crestlinesoaring.org/wx/umwx/betaOne/";
        	var fileName = moment().subtract(1,"days").format("[wx]YYYYMMDD[.dat]");
        	return filePath + fileName;
        }
        function getTempDataPointsFromCSV(csv) {
            var dataPoints = csvLines = points = [];
            csvLines = csv.split(/[\r?\n|\r|\n]+/);         
		        
            for (var i = 0; i < csvLines.length; i++)
                if (csvLines[i].length > 0) {
                    points = csvLines[i].split(",");
                    dataPoints.push({ 
                        x: new Date(points[1] + " " + points[0]), 
                        y: parseFloat(points[12])*50 		
                    });
                }
            return dataPoints;
        }
                function getSolarADataPointsFromCSV(csv) {
            var dataPoints = csvLines = points = [];
            csvLines = csv.split(/[\r?\n|\r|\n]+/);         
		        
            for (var i = 0; i < csvLines.length; i++)
                if (csvLines[i].length > 0) {
                    points = csvLines[i].split(",");
                    dataPoints.push({ 
                        x: new Date(points[1] + " " + points[0]), 
                        y: parseFloat(points[14]) 		
                    });
                }
            return dataPoints;
        }
                function getSolarVDataPointsFromCSV(csv) {
            var dataPoints = csvLines = points = [];
            csvLines = csv.split(/[\r?\n|\r|\n]+/);         
		        
            for (var i = 0; i < csvLines.length; i++)
                if (csvLines[i].length > 0) {
                    points = csvLines[i].split(",");
                    dataPoints.push({ 
                        x: new Date(points[1] + " " + points[0]), 
                        y: ((Math.abs(parseFloat(points[15])) < 12) ? 0 : (Math.abs(points[15])-11.5)*300)
                    });
                }
            return dataPoints;
        }
                function getBattADataPointsFromCSV(csv) {
            var dataPoints = csvLines = points = [];
            csvLines = csv.split(/[\r?\n|\r|\n]+/);         
		        
            for (var i = 0; i < csvLines.length; i++)
                if (csvLines[i].length > 0) {
                    points = csvLines[i].split(",");
                    dataPoints.push({ 
                        x: new Date(points[1] + " " + points[0]), 
                        y: parseFloat(points[16]) 		
                    });
                }
            return dataPoints;
        }
                function getBattVDataPointsFromCSV(csv) {
            var dataPoints = csvLines = points = [];
            csvLines = csv.split(/[\r?\n|\r|\n]+/);         
		        
            for (var i = 0; i < csvLines.length; i++)
                if (csvLines[i].length > 0) {
                    points = csvLines[i].split(",");
                    dataPoints.push({ 
                        x: new Date(points[1] + " " + points[0]), 
                        y: Math.abs(parseFloat(points[17])-11.5)*300 		
                    });
                }
            return dataPoints;
        }
	
	$.get(getFilePath(), function(data) {
	    var chart = new CanvasJS.Chart("chartContainer", {
	    	 title:{
     text: moment().subtract(1,"days").format("[wx]YYYYMMDD[.dat]")
    // more attributes 
 },
		          legend: {
       horizontalAlign: "left", // "center" , "right"
       verticalAlign: "center",  // "top" , "bottom"
       fontSize: 15
     },
exportEnabled: true,
zoomEnabled: true,
      axisX:{
        title: "Time",
        valueFormatString:  "HH:mm"
     },
		    data: [{
		    			xValueFormatString:"HH:mm",
		                legendText: "Temp",
		          		xValueType: "time",
		                showInLegend: true,

		         type: "line",
		         dataPoints: getTempDataPointsFromCSV(data)
		      },{
		                xValueFormatString:"HH:mm",
		                legendText: "SolarA",
		          		xValueType: "time",
		         showInLegend: true,
		         type: "line",
		         dataPoints: getSolarADataPointsFromCSV(data)
		      },{
		         xValueFormatString:"HH:mm",
		         legendText: "SolarV",
		          		xValueType: "time",
		         showInLegend: true,
		         type: "line",
		         dataPoints: getSolarVDataPointsFromCSV(data)
		      },{
		                xValueFormatString:"HH:mm",
		                legendText: "BattA",
		          		xValueType: "time",
		                showInLegend: true,
		         type: "line",
		         dataPoints: getBattADataPointsFromCSV(data)
		      },{
		                xValueFormatString:"HH:mm",
		                legendText: "BattV",
		          		xValueType: "time",
		                showInLegend: true,
		         type: "line",
		         dataPoints: getBattVDataPointsFromCSV(data)
		      }
		      
		      ]
	     });
		
	      chart.render();

	});
  }

        
        
        
        
        
        
        </script>
    </head>
    <body>
        <div id="chartContainer" style="width:100%; height:300px;"></div>
    </body>
</html>